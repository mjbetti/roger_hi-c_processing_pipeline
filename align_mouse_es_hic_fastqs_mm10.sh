module load g/bwa/0.7.17
module load g/samtools/1.10

#Declare all of the paired fastq files for each rep
FASTQ_DIR=/gpfs/gpfs2/home/mbetti/4dn_pipeline/mouse_es_mm10/fastq

#Declare the path of the reference genome fasta. The fasta was downloaded from https://www.encodeproject.org/files/mm10_no_alt_analysis_set_ENCODE/@@download/mm10_no_alt_analysis_set_ENCODE.fasta.gz. The ref genome should be indexed using bwa index
REF_GENOME=/gpfs/gpfs2/home/mbetti/4dn_pipeline/reference/mm10/mm10_no_alt_analysis_set_ENCODE.fasta

#Declare an output directory for the initial paired alignments
PAIRED_ALN_DIR=/gpfs/gpfs2/home/mbetti/4dn_pipeline/mouse_es_mm10/paired_aln
mkdir $PAIRED_ALN_DIR

#Declare the output prefix for each bam file
OUT_PREF=mouse_es_mm10_hic

#Biosample SAMN09076491
    #read 1
SAMN09076491_P1F1=$FASTQ_DIR\/SRR7123067_1.fastq
SAMN09076491_P2F1=$FASTQ_DIR\/SRR7123068_1.fastq
SAMN09076491_P3F1=$FASTQ_DIR\/SRR7123069_1.fastq
SAMN09076491_P4F1=$FASTQ_DIR\/SRR7123070_1.fastq

    #read 2
SAMN09076491_P1F2=$FASTQ_DIR\/SRR7123067_2.fastq
SAMN09076491_P2F2=$FASTQ_DIR\/SRR7123068_2.fastq
SAMN09076491_P3F2=$FASTQ_DIR\/SRR7123069_2.fastq
SAMN09076491_P4F2=$FASTQ_DIR\/SRR7123070_2.fastq

#Biosample SAMN09076489
    #read 1
SAMN09076489_P1F1=$FASTQ_DIR\/SRR7123071_1.fastq
SAMN09076489_P2F1=$FASTQ_DIR\/SRR7123072_1.fastq
SAMN09076489_P3F1=$FASTQ_DIR\/SRR7123073_1.fastq
SAMN09076489_P4F1=$FASTQ_DIR\/SRR7123074_1.fastq

    #read 2
SAMN09076489_P1F2=$FASTQ_DIR\/SRR7123071_2.fastq
SAMN09076489_P2F2=$FASTQ_DIR\/SRR7123072_2.fastq
SAMN09076489_P3F2=$FASTQ_DIR\/SRR7123073_2.fastq
SAMN09076489_P4F2=$FASTQ_DIR\/SRR7123074_2.fastq

#Biosample SAMN09076488
    #read 1
SAMN09076488_P1F1=$FASTQ_DIR\/SRR7123075_1.fastq
SAMN09076488_P2F1=$FASTQ_DIR\/SRR7123076_1.fastq
SAMN09076488_P3F1=$FASTQ_DIR\/SRR7123077_1.fastq
SAMN09076488_P4F1=$FASTQ_DIR\/SRR7123078_1.fastq

    #read 2
SAMN09076488_P1F2=$FASTQ_DIR\/SRR7123075_2.fastq
SAMN09076488_P2F2=$FASTQ_DIR\/SRR7123076_2.fastq
SAMN09076488_P3F2=$FASTQ_DIR\/SRR7123077_2.fastq
SAMN09076488_P4F2=$FASTQ_DIR\/SRR7123078_2.fastq

#Biosample SAMN09076487
    #read 1
SAMN09076487_P1F1=$FASTQ_DIR\/SRR7123079_1.fastq
SAMN09076487_P2F1=$FASTQ_DIR\/SRR7123080_1.fastq
SAMN09076487_P3F1=$FASTQ_DIR\/SRR7123081_1.fastq
SAMN09076487_P4F1=$FASTQ_DIR\/SRR7123082_1.fastq

    #read 2
SAMN09076487_P1F2=$FASTQ_DIR\/SRR7123079_2.fastq
SAMN09076487_P2F2=$FASTQ_DIR\/SRR7123080_2.fastq
SAMN09076487_P3F2=$FASTQ_DIR\/SRR7123081_2.fastq
SAMN09076487_P4F2=$FASTQ_DIR\/SRR7123082_2.fastq

#Biosample SAMN09076486
    #read 1
SAMN09076486_P1F1=$FASTQ_DIR\/SRR7123083_1.fastq
SAMN09076486_P2F1=$FASTQ_DIR\/SRR7123084_1.fastq
SAMN09076486_P3F1=$FASTQ_DIR\/SRR7123085_1.fastq
SAMN09076486_P4F1=$FASTQ_DIR\/SRR7123086_1.fastq

    #read 2
SAMN09076486_P1F2=$FASTQ_DIR\/SRR7123083_2.fastq
SAMN09076486_P2F2=$FASTQ_DIR\/SRR7123084_2.fastq
SAMN09076486_P3F2=$FASTQ_DIR\/SRR7123085_2.fastq
SAMN09076486_P4F2=$FASTQ_DIR\/SRR7123086_2.fastq

#Biosample SAMN09076485
    #read 1
SAMN09076485_P1F1=$FASTQ_DIR\/SRR7123087_1.fastq
SAMN09076485_P2F1=$FASTQ_DIR\/SRR7123088_1.fastq
SAMN09076485_P3F1=$FASTQ_DIR\/SRR7123089_1.fastq
SAMN09076485_P4F1=$FASTQ_DIR\/SRR7123090_1.fastq

    #read 2
SAMN09076485_P1F2=$FASTQ_DIR\/SRR7123087_2.fastq
SAMN09076485_P2F2=$FASTQ_DIR\/SRR7123088_2.fastq
SAMN09076485_P3F2=$FASTQ_DIR\/SRR7123089_2.fastq
SAMN09076485_P4F2=$FASTQ_DIR\/SRR7123090_2.fastq

#Biosample SAMN09076484
    #read 1
SAMN09076484_P1F1=$FASTQ_DIR\/SRR7123091_1.fastq
SAMN09076484_P2F1=$FASTQ_DIR\/SRR7123092_1.fastq
SAMN09076484_P3F1=$FASTQ_DIR\/SRR7123093_1.fastq
SAMN09076484_P4F1=$FASTQ_DIR\/SRR7123094_1.fastq

    #read 2
SAMN09076484_P1F2=$FASTQ_DIR\/SRR7123091_2.fastq
SAMN09076484_P2F2=$FASTQ_DIR\/SRR7123092_2.fastq
SAMN09076484_P3F2=$FASTQ_DIR\/SRR7123093_2.fastq
SAMN09076484_P4F2=$FASTQ_DIR\/SRR7123094_2.fastq

#Biosample SAMN09076483
    #read 1
SAMN09076483_P1F1=$FASTQ_DIR\/SRR7123095_1.fastq
SAMN09076483_P2F1=$FASTQ_DIR\/SRR7123096_1.fastq
SAMN09076483_P3F1=$FASTQ_DIR\/SRR7123097_1.fastq
SAMN09076483_P4F1=$FASTQ_DIR\/SRR7123098_1.fastq

    #read 2
SAMN09076483_P1F2=$FASTQ_DIR\/SRR7123095_2.fastq
SAMN09076483_P2F2=$FASTQ_DIR\/SRR7123096_2.fastq
SAMN09076483_P3F2=$FASTQ_DIR\/SRR7123097_2.fastq
SAMN09076483_P4F2=$FASTQ_DIR\/SRR7123098_2.fastq

#Biosample SAMN09076482
    #read 1
SAMN09076482_P1F1=$FASTQ_DIR\/SRR7123099_1.fastq
SAMN09076482_P2F1=$FASTQ_DIR\/SRR7123100_1.fastq
SAMN09076482_P3F1=$FASTQ_DIR\/SRR7123101_1.fastq
SAMN09076482_P4F1=$FASTQ_DIR\/SRR7123102_1.fastq

    #read 2
SAMN09076482_P1F2=$FASTQ_DIR\/SRR7123099_2.fastq
SAMN09076482_P2F2=$FASTQ_DIR\/SRR7123100_2.fastq
SAMN09076482_P3F2=$FASTQ_DIR\/SRR7123101_2.fastq
SAMN09076482_P4F2=$FASTQ_DIR\/SRR7123102_2.fastq

#Biosample SAMN09076481
    #read 1
SAMN09076481_P1F1=$FASTQ_DIR\/SRR7123103_1.fastq
SAMN09076481_P2F1=$FASTQ_DIR\/SRR7123104_1.fastq
SAMN09076481_P3F1=$FASTQ_DIR\/SRR7123105_1.fastq
SAMN09076481_P4F1=$FASTQ_DIR\/SRR7123106_1.fastq

    #read 2
SAMN09076481_P1F2=$FASTQ_DIR\/SRR7123103_2.fastq
SAMN09076481_P2F2=$FASTQ_DIR\/SRR7123104_2.fastq
SAMN09076481_P3F2=$FASTQ_DIR\/SRR7123105_2.fastq
SAMN09076481_P4F2=$FASTQ_DIR\/SRR7123106_2.fastq

#Biosample SAMN09076480
    #read 1
SAMN09076480_P1F1=$FASTQ_DIR\/SRR7123107_1.fastq
SAMN09076480_P2F1=$FASTQ_DIR\/SRR7123108_1.fastq
SAMN09076480_P3F1=$FASTQ_DIR\/SRR7123109_1.fastq
SAMN09076480_P4F1=$FASTQ_DIR\/SRR7123110_1.fastq

    #read 2
SAMN09076480_P1F2=$FASTQ_DIR\/SRR7123107_2.fastq
SAMN09076480_P2F2=$FASTQ_DIR\/SRR7123108_2.fastq
SAMN09076480_P3F2=$FASTQ_DIR\/SRR7123109_2.fastq
SAMN09076480_P4F2=$FASTQ_DIR\/SRR7123110_2.fastq

#Biosample SAMN09076479
    #read 1
SAMN09076479_P1F1=$FASTQ_DIR\/SRR7123111_1.fastq
SAMN09076479_P2F1=$FASTQ_DIR\/SRR7123112_1.fastq
SAMN09076479_P3F1=$FASTQ_DIR\/SRR7123113_1.fastq
SAMN09076479_P4F1=$FASTQ_DIR\/SRR7123114_1.fastq

    #read 2
SAMN09076479_P1F2=$FASTQ_DIR\/SRR7123111_2.fastq
SAMN09076479_P2F2=$FASTQ_DIR\/SRR7123112_2.fastq
SAMN09076479_P3F2=$FASTQ_DIR\/SRR7123113_2.fastq
SAMN09076479_P4F2=$FASTQ_DIR\/SRR7123114_2.fastq

#Biosample SAMN09076477
    #read 1
SAMN09076477_P1F1=$FASTQ_DIR\/SRR7123115_1.fastq
SAMN09076477_P2F1=$FASTQ_DIR\/SRR7123116_1.fastq
SAMN09076477_P3F1=$FASTQ_DIR\/SRR7123117_1.fastq
SAMN09076477_P4F1=$FASTQ_DIR\/SRR7123118_1.fastq

    #read 2
SAMN09076477_P1F2=$FASTQ_DIR\/SRR7123115_2.fastq
SAMN09076477_P2F2=$FASTQ_DIR\/SRR7123116_2.fastq
SAMN09076477_P3F2=$FASTQ_DIR\/SRR7123117_2.fastq
SAMN09076477_P4F2=$FASTQ_DIR\/SRR7123118_2.fastq

#On SRA Run Selector, the reads are organized by experiment number, with 4 fastq files per experiment. Merge the fastqs together by experiment (forward and reverse reads in separate fastq files)
MERGED_FASTQ_DIR=$FASTQ_DIR\/merged
mkdir $MERGED_FASTQ_DIR

    #Biosample SAMN09076491
cat $SAMN09076491_P1F1 $SAMN09076491_P2F1 $SAMN09076491_P3F1 $SAMN09076491_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076491_1.fastq
cat $SAMN09076491_P1F2 $SAMN09076491_P2F2 $SAMN09076491_P3F2 $SAMN09076491_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076491_2.fastq

    #Biosample SAMN09076489
cat $SAMN09076489_P1F1 $SAMN09076489_P2F1 $SAMN09076489_P3F1 $SAMN09076489_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076489_1.fastq
cat $SAMN09076489_P1F2 $SAMN09076489_P2F2 $SAMN09076489_P3F2 $SAMN09076489_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076489_2.fastq

    #Biosample SAMN09076488
cat $SAMN09076488_P1F1 $SAMN09076488_P2F1 $SAMN09076488_P3F1 $SAMN09076488_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076488_1.fastq
cat $SAMN09076488_P1F2 $SAMN09076488_P2F2 $SAMN09076488_P3F2 $SAMN09076488_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076488_2.fastq
    
    #Biosample SAMN09076487
cat $SAMN09076487_P1F1 $SAMN09076487_P2F1 $SAMN09076487_P3F1 $SAMN09076487_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076487_1.fastq
cat $SAMN09076487_P1F2 $SAMN09076487_P2F2 $SAMN09076487_P3F2 $SAMN09076487_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076487_2.fastq

    #Biosample SAMN09076486
cat $SAMN09076486_P1F1 $SAMN09076486_P2F1 $SAMN09076486_P3F1 $SAMN09076486_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076486_1.fastq
cat $SAMN09076486_P1F2 $SAMN09076486_P2F2 $SAMN09076486_P3F2 $SAMN09076486_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076486_2.fastq

    #Biosample SAMN09076485
cat $SAMN09076485_P1F1 $SAMN09076485_P2F1 $SAMN09076485_P3F1 $SAMN09076485_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076485_1.fastq
cat $SAMN09076485_P1F2 $SAMN09076485_P2F2 $SAMN09076485_P3F2 $SAMN09076485_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076485_2.fastq

    #Biosample SAMN09076484
cat $SAMN09076484_P1F1 $SAMN09076484_P2F1 $SAMN09076484_P3F1 $SAMN09076484_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076484_1.fastq
cat $SAMN09076484_P1F2 $SAMN09076484_P2F2 $SAMN09076484_P3F2 $SAMN09076484_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076484_2.fastq

    #Biosample SAMN09076483
cat $SAMN09076483_P1F1 $SAMN09076483_P2F1 $SAMN09076483_P3F1 $SAMN09076483_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076483_1.fastq
cat $SAMN09076483_P1F2 $SAMN09076483_P2F2 $SAMN09076483_P3F2 $SAMN09076483_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076483_2.fastq
    
    #Biosample SAMN09076482
cat $SAMN09076482_P1F1 $SAMN09076482_P2F1 $SAMN09076482_P3F1 $SAMN09076482_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076482_1.fastq
cat $SAMN09076482_P1F2 $SAMN09076482_P2F2 $SAMN09076482_P3F2 $SAMN09076482_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076482_2.fastq

    #Biosample SAMN09076481
cat $SAMN09076481_P1F1 $SAMN09076481_P2F1 $SAMN09076481_P3F1 $SAMN09076481_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076481_1.fastq
cat $SAMN09076481_P1F2 $SAMN09076481_P2F2 $SAMN09076481_P3F2 $SAMN09076481_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076481_2.fastq

    #Biosample SAMN09076480
cat $SAMN09076480_P1F1 $SAMN09076480_P2F1 $SAMN09076480_P3F1 $SAMN09076480_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076480_1.fastq
cat $SAMN09076480_P1F2 $SAMN09076480_P2F2 $SAMN09076480_P3F2 $SAMN09076480_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076480_2.fastq

    #Biosample SAMN09076479
cat $SAMN09076479_P1F1 $SAMN09076479_P2F1 $SAMN09076479_P3F1 $SAMN09076479_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076479_1.fastq
cat $SAMN09076479_P1F2 $SAMN09076479_P2F2 $SAMN09076479_P3F2 $SAMN09076479_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076479_2.fastq

    #Biosample SAMN09076477
cat $SAMN09076477_P1F1 $SAMN09076477_P2F1 $SAMN09076477_P3F1 $SAMN09076477_P4F1 > $MERGED_FASTQ_DIR\/SAMN09076477_1.fastq
cat $SAMN09076477_P1F2 $SAMN09076477_P2F2 $SAMN09076477_P3F2 $SAMN09076477_P4F2 > $MERGED_FASTQ_DIR\/SAMN09076477_2.fastq

#Align each read pair to hg38 using bwa-mem


    #Biosample SAMN09076491
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076491_1.fastq $MERGED_FASTQ_DIR\/SAMN09076491_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076491.bam

    #Biosample SAMN09076489
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076489_1.fastq $MERGED_FASTQ_DIR\/SAMN09076489_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076489.bam

    #Biosample SAMN09076488
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076488_1.fastq $MERGED_FASTQ_DIR\/SAMN09076488_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076488.bam

    #Biosample SAMN09076487
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076487_1.fastq $MERGED_FASTQ_DIR\/SAMN09076487_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076487.bam

    #Biosample SAMN09076486
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076486_1.fastq $MERGED_FASTQ_DIR\/SAMN09076486_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076486.bam

    #Biosample SAMN09076485
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076485_1.fastq $MERGED_FASTQ_DIR\/SAMN09076485_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076485.bam

    #Biosample SAMN09076484
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076484_1.fastq $MERGED_FASTQ_DIR\/SAMN09076484_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076484.bam

    #Biosample SAMN09076483
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076483_1.fastq $MERGED_FASTQ_DIR\/SAMN09076483_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076483.bam

    #Biosample SAMN09076482
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076482_1.fastq $MERGED_FASTQ_DIR\/SAMN09076482_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076482.bam

    #Biosample SAMN09076481
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076481_1.fastq $MERGED_FASTQ_DIR\/SAMN09076481_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076481.bam

    #Biosample SAMN09076480
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076480_1.fastq $MERGED_FASTQ_DIR\/SAMN09076480_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076480.bam

    #Biosample SAMN09076479
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076479_1.fastq $MERGED_FASTQ_DIR\/SAMN09076479_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076479.bam

    #Biosample SAMN09076477
bwa mem -SP5M -t 32 $REF_GENOME $MERGED_FASTQ_DIR\/SAMN09076477_1.fastq $MERGED_FASTQ_DIR\/SAMN09076477_2.fastq | samtools view -Shb -o $PAIRED_ALN_DIR\/$OUT_PREF\_SAMN09076477.bam

